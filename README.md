# NUT UPS Server & WinNUT Client Setup

This repository contains **step-by-step instructions, configuration examples, and automation scripts** for setting up a reliable UPS monitoring and shutdown system using Network UPS Tools (NUT) on a Raspberry Pi, with Windows PC clients running **WinNUT** for UPS status monitoring and automated shutdown.

It also covers:

- Creating appropriate udev USB rules to allow NUT to access the UPS device.
- Configuring the NUT server (`nut-server` and `nut-monitor`) on Raspberry Pi.
- Setting up WinNUT client on Windows with automatic admin startup.
- Deploying a modern web-based UPS monitoring dashboard using `nut_webgui` Docker container.
- Scripts to automate server-side setup and generate Windows client config files.

---

## Features

- Auto-detection of UPS via `nut-scanner` for server config.
- Secure user management with admin and slave roles.
- Networked UPS data serving over TCP port `3493`.
- Windows WinNUT client configuration generator for quick setup.
- USB permission management with udev rules.
- Dockerized `nut_webgui` for visual UPS monitoring accessible via web browser.
- Support for graceful shutdown sequences with configurable delays.

---

## Requirements

- Raspberry Pi running Raspberry Pi OS (Debian-based)
- USB-connected UPS
- Windows PC for WinNUT client
- Docker installed on Raspberry Pi (for web UI)
- Network connectivity between Pi and Windows clients

---

## Setup Overview

### 1. Raspberry Pi NUT Server

- Install NUT packages.
- Use the included bash script (`autonut.sh`) to auto-detect UPS, prompt for credentials, and generate config files.
- Reload udev rules and restart NUT services.

### 2. Windows PC WinNUT Client

- Install WinNUT Client from [GitHub releases](https://github.com/nutdotnet/WinNUT-Client/releases).
- Use the generated `WinNUTClient.ini` configuration block for seamless connection.
- Set WinNUT to run as administrator automatically (Task Scheduler recommended to avoid UAC prompts).

### 3. nut_webgui Dashboard (Optional)

- Run the `nut_webgui` Docker container for a modern UPS monitoring web UI.
- Connect via `http://<pi-ip>:9000` or configured port.

---

## Usage

- Test UPS with:
upsc myups

text
- Simulate forced shutdown:
sudo upsmon -c fsd

text
- Monitor UPS status and connected clients via the `nut_webgui` dashboard.
- Ensure Windows clients shut down properly and the Pi follows after the configured delay.

---

## Files & Scripts

- `autonut.sh` — Bash script for automated server setup including USB detection and config file generation.
- Windows `WinNUTClient.ini` snippet — Generated by the setup script for quick copy & paste into WinNUT client config.
- Sample config files under `/etc/nut/` directory for reference.
- Docker run command example for nut_webgui setup.

---

## Troubleshooting

- **ERR ACCESS-DENIED** errors usually indicate user/password mismatch; verify `/etc/nut/upsd.users` and `/etc/nut/upsmon.conf`.
- USB permission issues resolved by creating the correct udev rule.
- Confirm network connectivity and firewall allow traffic on port 3493.
- Make sure WinNUT runs as administrator on Windows for shutdown functionality.
- If nut_webgui shows "no device available," check UPS detection and authentication.

---

## Contributing

Feel free to submit issues, suggest improvements, or supply scripts to improve automation and ease of NUT deployment in mixed Linux-Windows environments.

---

## License

This project is licensed under the MIT License.

---

## References

- [Network UPS Tools (NUT) Official Website](https://networkupstools.org/)
- [WinNUT Client GitHub Repository](https://github.com/nutdotnet/WinNUT-Client)
- [nut_webgui Docker Project](https://github.com/superioone/nut_webgui)
- [Techno Tim NUT Setup Guide](https://technotim.live/posts/NUT-server-guide/)

---

*This repository provides a comprehensive solution for setting up and managing UPS devices with Network UPS Tools on Raspberry Pi, with Windows clients and modern web monitoring tools to ensure safe and effective power management.*
